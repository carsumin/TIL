🌱 TIL Day 1 — 카테고리 기준 매출 집계 쿼리 이해하기
📌 오늘의 학습 목표

결과 단위를 기준으로 기준 테이블을 선택하는 원리 이해

LEFT JOIN을 왜 쓰는지, INNER JOIN과 어떤 차이가 나는지 명확히 구분

OUTER JOIN(LEFT/RIGHT/FULL)의 개념 정리

🧩 문제 시나리오

쇼핑몰 데이터 구조는 다음과 같음:

CATEGORY(category_id, category_name)

PRODUCT(product_id, category_id, name, price)

ORDER_ITEM(order_item_id, order_id, product_id, quantity)

📗 문제:
“카테고리별 총 판매 금액과 총 판매 수량을 구하라.”

🎯 기준 테이블 선정 원칙

문제에서 요구하는 출력의 최소 단위 → 카테고리별

주문/상품이 없어도 모든 카테고리 한 줄씩은 결과에 나와야 함

👉 그래서 기준 테이블은 CATEGORY
👉 따라서 LEFT JOIN 구조가 자연스러움

🛠️ LEFT JOIN을 사용해야 하는 이유

INNER JOIN 을 쓰면

상품이 없는 카테고리

판매된 적 없는 상품이 있는 카테고리
→ 결과에서 완전히 사라짐

LEFT JOIN 을 쓰면

기준 테이블인 CATEGORY 는 무조건 유지

매칭되는 데이터가 없으면 NULL 로 채워짐 → 합산 시 COALESCE 로 처리 가능

🔍 OUTER JOIN 정리

OUTER JOIN = 포괄 개념

LEFT OUTER JOIN → 왼쪽 테이블을 기준으로 모두 보여줌

RIGHT OUTER JOIN → 오른쪽 기준 (실무에서 거의 안 씀)

FULL OUTER JOIN → 두 테이블 어느 쪽에도 매칭되는 모든 행 출력 (MySQL 미지원)

👉 실무 기준: LEFT JOIN 하나만 명확히 이해해도 충분함

🧾 최종 쿼리 (오늘 학습의 결과물)
SELECT
    c.category_id,
    c.category_name,
    COALESCE(SUM(p.price * oi.quantity), 0) AS total_sales_amount,
    COALESCE(SUM(oi.quantity), 0)          AS total_quantity
FROM CATEGORY c
LEFT JOIN PRODUCT p
    ON p.category_id = c.category_id
LEFT JOIN ORDER_ITEM oi
    ON oi.product_id = p.product_id
GROUP BY
    c.category_id,
    c.category_name
ORDER BY
    c.category_id;

📝 오늘 배운 점 정리

“결과를 어떤 단위로 볼 것인가?” → 기준 테이블 선택의 핵심

기준 테이블이 유지되어야 한다면 LEFT JOIN이 필수

주문이 없어도 카테고리는 존재하므로 CATEGORY 기준이 맞음

OUTER JOIN은 LEFT/RIGHT/FULL 을 포함하는 상위 개념

실무에서는 LEFT JOIN 을 가장 많이 사용하며 RIGHT 는 지양함

구식 쿼리 스타일에서 벗어나기 위해

FROM A, B, C → X

JOIN ON → O

명확한 기준 테이블 → O

명확한 JOIN 방향(LEFT/INNER) → O

📅 다음 학습 방향

동일한 문제를 PRODUCT 기준으로도 한 번 조인해보고 결과 차이 비교

날짜 조건(o.order_date)이 들어가는 버전도 연습

FULL OUTER JOIN 가능한 DB(PostgreSQL 등)에서의 결과 차이도 비교 예정
