Day 1 – SQL JOIN 구조 이해하기 (카테고리 매출 집계 문제)
📌 오늘의 문제

카테고리별로 판매된 총 금액과 총 판매 수량을 구하는 SQL을 작성하라.

테이블 구조

CATEGORY(category_id, category_name)

PRODUCT(product_id, category_id, name, price)

ORDER_ITEM(order_item_id, order_id, product_id, quantity)

요구사항

결과는 카테고리별 한 줄이어야 한다.

주문이 없거나 상품이 없어도 카테고리는 모두 표시되어야 한다.

판매금액 = price × quantity

판매수량 = quantity 총합

🧠 기준 테이블 선정

결과가 “카테고리별”로 나와야 하므로
→ 기준 테이블은 CATEGORY

기준 테이블은 LEFT JOIN 의 왼쪽에 둔다.
→ 주문이 없어도 카테고리가 빠지지 않음.

🧩 JOIN 흐름 정리

CATEGORY ←(LEFT JOIN)→ PRODUCT

PRODUCT ←(LEFT JOIN)→ ORDER_ITEM

ORDER_ITEM의 quantity 합산

price × quantity 로 총 금액 계산

NULL 발생 가능성 → COALESCE로 0 처리

✅ 최종 SQL
SELECT
  c.category_id,
  c.category_name,
  COALESCE(SUM(p.price * oi.quantity), 0) AS total_sales_amount,
  COALESCE(SUM(oi.quantity), 0)          AS total_quantity
FROM CATEGORY c
LEFT JOIN PRODUCT p
  ON p.category_id = c.category_id
LEFT JOIN ORDER_ITEM oi
  ON oi.product_id = p.product_id
GROUP BY
  c.category_id,
  c.category_name
ORDER BY
  c.category_id;

📚 오늘 배운 점

기준 테이블을 명확히 잡으면 조인 설계가 쉬워진다.

기준 테이블의 데이터가 모두 나와야 할 경우 → LEFT JOIN 사용

INNER JOIN은 조인 조건이 안 맞으면 행이 사라지므로 이번 문제에 부적합.

NULL 처리는 COALESCE로 안전하게 0으로 변환.

OUTER JOIN은 LEFT/RIGHT/FULL의 상위 개념이며 실무에서는 LEFT JOIN 중심으로 사용.
